{"version":3,"sources":["server.js"],"names":[],"mappings":"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","file":"server-compiled.js","sourcesContent":["\nvar http = require('http');\nvar parse = require('url').parse;\nvar zlib = require('zlib');\nvar stream = require('stream');\nvar convert = require('encoding').convert;\nvar Multipart = require('parted').multipart;\n\nmodule.exports = TestServer;\n\nfunction TestServer() {\n\tthis.server = http.createServer(this.router);\n\tthis.port = 30001;\n\tthis.hostname = 'localhost';\n\t// node 8 default keepalive timeout is 5000ms\n\t// make it shorter here as we want to close server quickly at the end of tests\n\tthis.server.keepAliveTimeout = 1000;\n\tthis.server.on('error', function(err) {\n\t\tconsole.log(err.stack);\n\t});\n\tthis.server.on('connection', function(socket) {\n\t\tsocket.setTimeout(1500);\n\t});\n}\n\nTestServer.prototype.start = function(cb) {\n\tthis.server.listen(this.port, this.hostname, cb);\n}\n\nTestServer.prototype.stop = function(cb) {\n\tthis.server.close(cb);\n}\n\nTestServer.prototype.router = function(req, res) {\n\n\tvar p = parse(req.url).pathname;\n\n\tif (p === '/hello') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.end('world');\n\t}\n\n\tif (p === '/plain') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.end('text');\n\t}\n\n\tif (p === '/options') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Allow', 'GET, HEAD, OPTIONS');\n\t\tres.end('hello world');\n\t}\n\n\tif (p === '/html') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/html');\n\t\tres.end('<html></html>');\n\t}\n\n\tif (p === '/json') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'application/json');\n\t\tres.end(JSON.stringify({\n\t\t\tname: 'value'\n\t\t}));\n\t}\n\n\tif (p === '/gzip') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.setHeader('Content-Encoding', 'gzip');\n\t\tzlib.gzip('hello world', function(err, buffer) {\n\t\t\tres.end(buffer);\n\t\t});\n\t}\n\n\tif (p === '/deflate') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.setHeader('Content-Encoding', 'deflate');\n\t\tzlib.deflate('hello world', function(err, buffer) {\n\t\t\tres.end(buffer);\n\t\t});\n\t}\n\n\tif (p === '/deflate-raw') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.setHeader('Content-Encoding', 'deflate');\n\t\tzlib.deflateRaw('hello world', function(err, buffer) {\n\t\t\tres.end(buffer);\n\t\t});\n\t}\n\n\tif (p === '/sdch') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.setHeader('Content-Encoding', 'sdch');\n\t\tres.end('fake sdch string');\n\t}\n\n\tif (p === '/invalid-content-encoding') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.setHeader('Content-Encoding', 'gzip');\n\t\tres.end('fake gzip string');\n\t}\n\n\tif (p === '/timeout') {\n\t\tsetTimeout(function() {\n\t\t\tres.statusCode = 200;\n\t\t\tres.setHeader('Content-Type', 'text/plain');\n\t\t\tres.end('text');\n\t\t}, 1000);\n\t}\n\n\tif (p === '/slow') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.write('test');\n\t\tsetTimeout(function() {\n\t\t\tres.end('test');\n\t\t}, 1000);\n\t}\n\n\tif (p === '/cookie') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Set-Cookie', ['a=1', 'b=1']);\n\t\tres.end('cookie');\n\t}\n\n\tif (p === '/size/chunk') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tsetTimeout(function() {\n\t\t\tres.write('test');\n\t\t}, 50);\n\t\tsetTimeout(function() {\n\t\t\tres.end('test');\n\t\t}, 100);\n\t}\n\n\tif (p === '/size/long') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.end('testtest');\n\t}\n\n\tif (p === '/encoding/gbk') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/html');\n\t\tres.end(convert('<meta charset=\"gbk\"><div>中文</div>', 'gbk'));\n\t}\n\n\tif (p === '/encoding/gb2312') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/html');\n\t\tres.end(convert('<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"><div>中文</div>', 'gb2312'));\n\t}\n\n\tif (p === '/encoding/shift-jis') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/html; charset=Shift-JIS');\n\t\tres.end(convert('<div>日本語</div>', 'Shift_JIS'));\n\t}\n\n\tif (p === '/encoding/euc-jp') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/xml');\n\t\tres.end(convert('<?xml version=\"1.0\" encoding=\"EUC-JP\"?><title>日本語</title>', 'EUC-JP'));\n\t}\n\n\tif (p === '/encoding/utf8') {\n\t\tres.statusCode = 200;\n\t\tres.end('中文');\n\t}\n\n\tif (p === '/encoding/order1') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'charset=gbk; text/plain');\n\t\tres.end(convert('中文', 'gbk'));\n\t}\n\n\tif (p === '/encoding/order2') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/plain; charset=gbk; qs=1');\n\t\tres.end(convert('中文', 'gbk'));\n\t}\n\n\tif (p === '/encoding/chunked') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/html');\n\t\tres.setHeader('Transfer-Encoding', 'chunked');\n\t\tvar padding = 'a';\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\tres.write(padding);\n\t\t}\n\t\tres.end(convert('<meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\" /><div>日本語</div>', 'Shift_JIS'));\n\t}\n\n\tif (p === '/encoding/invalid') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'text/html');\n\t\tres.setHeader('Transfer-Encoding', 'chunked');\n\t\t// because node v0.12 doesn't have str.repeat\n\t\tvar padding = new Array(120 + 1).join('a');\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\tres.write(padding);\n\t\t}\n\t\tres.end(convert('中文', 'gbk'));\n\t}\n\n\tif (p === '/redirect/301') {\n\t\tres.statusCode = 301;\n\t\tres.setHeader('Location', '/inspect');\n\t\tres.end();\n\t}\n\n\tif (p === '/redirect/302') {\n\t\tres.statusCode = 302;\n\t\tres.setHeader('Location', '/inspect');\n\t\tres.end();\n\t}\n\n\tif (p === '/redirect/303') {\n\t\tres.statusCode = 303;\n\t\tres.setHeader('Location', '/inspect');\n\t\tres.end();\n\t}\n\n\tif (p === '/redirect/307') {\n\t\tres.statusCode = 307;\n\t\tres.setHeader('Location', '/inspect');\n\t\tres.end();\n\t}\n\n\tif (p === '/redirect/308') {\n\t\tres.statusCode = 308;\n\t\tres.setHeader('Location', '/inspect');\n\t\tres.end();\n\t}\n\n\tif (p === '/redirect/chain') {\n\t\tres.statusCode = 301;\n\t\tres.setHeader('Location', '/redirect/301');\n\t\tres.end();\n\t}\n\n\tif (p === '/error/redirect') {\n\t\tres.statusCode = 301;\n\t\t//res.setHeader('Location', '/inspect');\n\t\tres.end();\n\t}\n\n\tif (p === '/error/400') {\n\t\tres.statusCode = 400;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.end('client error');\n\t}\n\n\tif (p === '/error/404') {\n\t\tres.statusCode = 404;\n\t\tres.setHeader('Content-Encoding', 'gzip');\n\t\tres.end();\n\t}\n\n\tif (p === '/error/500') {\n\t\tres.statusCode = 500;\n\t\tres.setHeader('Content-Type', 'text/plain');\n\t\tres.end('server error');\n\t}\n\n\tif (p === '/error/reset') {\n\t\tres.destroy();\n\t}\n\n\tif (p === '/error/json') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'application/json');\n\t\tres.end('invalid json');\n\t}\n\n\tif (p === '/no-content') {\n\t\tres.statusCode = 204;\n\t\tres.end();\n\t}\n\n\tif (p === '/no-content/gzip') {\n\t\tres.statusCode = 204;\n\t\tres.setHeader('Content-Encoding', 'gzip');\n\t\tres.end();\n\t}\n\n\tif (p === '/not-modified') {\n\t\tres.statusCode = 304;\n\t\tres.end();\n\t}\n\n\tif (p === '/not-modified/gzip') {\n\t\tres.statusCode = 304;\n\t\tres.setHeader('Content-Encoding', 'gzip');\n\t\tres.end();\n\t}\n\n\tif (p === '/inspect') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'application/json');\n\t\tvar body = '';\n\t\treq.on('data', function(c) { body += c });\n\t\treq.on('end', function() {\n\t\t\tres.end(JSON.stringify({\n\t\t\t\tmethod: req.method,\n\t\t\t\turl: req.url,\n\t\t\t\theaders: req.headers,\n\t\t\t\tbody: body\n\t\t\t}));\n\t\t});\n\t}\n\n\tif (p === '/multipart') {\n\t\tres.statusCode = 200;\n\t\tres.setHeader('Content-Type', 'application/json');\n\t\tvar parser = new Multipart(req.headers['content-type']);\n\t\tvar body = '';\n\t\tparser.on('part', function(field, part) {\n\t\t\tbody += field + '=' + part;\n\t\t});\n\t\tparser.on('end', function() {\n\t\t\tres.end(JSON.stringify({\n\t\t\t\tmethod: req.method,\n\t\t\t\turl: req.url,\n\t\t\t\theaders: req.headers,\n\t\t\t\tbody: body\n\t\t\t}));\n\t\t});\n\t\treq.pipe(parser);\n\t}\n}\n"]}